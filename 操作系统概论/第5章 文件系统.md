## 5.1 文件

1. 文件系统

   - 操作系统中处理文件的部分称为文件系统，文件系统包括了文件及管理文件的软件集合。
   - 本章分两部分来讨论文件系统，一部分是文件系统的用户接口，另一部分是文件系统的实现，包括文件的按名访问或存储空间管理的实现。
     - 文件系统的用户接口，即用户可以“看见”和使用的文件系统部分，包括文件的`命名`、`类型`、`属性`和对文件的`操作`。

2. 文件命名

   - 进程通过文件名对文件进行存取
   - 所有 OS 都允许 1-8 个字母的文件名
   - 多数 OS 支持用.把文件名分割成两部分：文件名称+文件扩展名
   - Windows 系统支持把扩展名和应用程序关联

3. 文件结构

   - 无结构字节序列，流式文件
   - 固定长度记录序列
   - 树形结构

4. 文件类型

   - 正规文件，包括 ASCII 文件和二进制文件
     - ASCII 文件，适用显示和打印，可以用文本编辑器编辑
     - 二进制文件，例如 exe 文件，一般不能直接显示或打印
   - 目录文件，管理文件的系统文件
   - 字符设备文件，用于输入/输出设备
   - 块设备文件，用于磁盘类设备

5. 文件存取：顺序存取、随机存取
6. 文件属性，文件相关信息

   - 创建日期、文件大小等

7. 文件操作
   - [操作系统——文件的基本操作](https://blog.csdn.net/qq_45741986/article/details/125233511)

## 5.2 目录

- OS 通过目录管理文件，目录又称为文件夹，目录是访问文件的重要数据结构。本节讨论目录的组成，目录的特性，目录的操作。

1. 层次目录系统

   - 1）目录文件的两种结构：属性放在目录项中和放在 i 结点中。
     - 目录文件包含许多目录项，每个目录项用于描述一个文件。在第一种结构中，每个目录项长度相同，每个文件对应一个目录项。
     - 在第二种目录结构中，目录项中有一个文件名和一个 i 结点号。i 结点是一种数据结构，文件属性和文件的地址信息存放在 i 结点中。
   - 2）目录结构
     - 单层目录，所有文件使用一张目录表
     - 两级目录，按用户划分目录
     - 树形目录

2. 路径名

   - 用目录树组织文件系统时，需要用路径指明文件名
   - 绝对路径名
     - 从根目录到文件的路径，即访问目录树经历的结点路径
   - 相对路径名
     - 为每个进程设置当前工作的目录，简化路径
     - 简称当前目录、工作目录、当前工作目录
   - 特殊目录项：.和..

3. 目录操作

- OPENDIR/CLOSEDIR/RENAME

## 5.3 文件系统的实现

1. 实现文件

   - 文件系统的实现，是 OS 为文件分配磁盘空间
     - 文件系统会把磁盘空间 n 个簇，为文件分配簇
     - 例如簇大小 2KB，文件大小 5KB，则需要分配 3 个簇，最后一个簇只用一半
   - 分配方式
     - 连续分配
       - 为文件分配一组相邻接的盘块
       - 优点：顺序访问实现容易，访问速度快
       - 缺点：要求有连续的存储空间，易产生碎片（空洞）
     - 使用磁盘链接表的分配
       - 为文件构造簇链接表，指针放在磁盘块中
       - 优点：不存在碎片、不需要连续空间
       - 缺点：适合顺序访问，不适合随机访问；可靠性差，其中某个指针出错将导致后面数据丢失；因为指针占用数据区，数据区大小不等于 2 的 n 次幂，不利于和内存页对应。
     - 使用内存的链接表分配
       - 簇号放在内存表，在内存创建文件分配表，在 MS-DOS 简称 FAT 表
       - 缺点：不支持高速直接存取。FAT 表占用额外内存空间。
     - i-结点分配
       - 为每个文件分配索引表，将文件所有盘块记录在索引表中
       - 一级索引：每个文件
       - 多级索引

2. 实现目录

   - OS 根据用户提供的路径名，打开目录项，查找簇信息
     - CP/M 目录
     - MS-DOS 目录
     - UNIX 目录，i-结点方式

3. 磁盘空间管理

   - 对空间进行分配与回收
     - 簇太小，文件链接指针或索引项太多，而且要多次寻道和旋转延迟
     - 簇太大，对于小文件要浪费空间
     - 簇大小的确定，一般是 2 的 n 次方个连续扇区
   - 记录空闲块的方式
     - 空闲簇链接表
     - 位图

## 思考与练习
