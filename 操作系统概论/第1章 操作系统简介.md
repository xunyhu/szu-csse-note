## 1.1 什么是操作系统

1. 什么是操作系统

   - 操作系统(Operating System, OS)是一种复杂的软件系统，是不同程序代码、数据结构、数据初始化文件的`集合`，可执行。
   - 操作系统提供计算机用户与计算机硬件之间的接口，并管理计算机`软件`和`硬件`资源。
   - 操作系统是覆盖在裸机上的`第一层软件`，编译程序、数据库管理系统及其他应用程序都运行在操作系统之上，操作系统为应用程序提供运行环境。

2. 用户与硬件之间的接口

   - 操作系统是用户与硬件之间的接口
     - 硬件接口：USB、串口、SATA
     - 软件接口：文件操作 fopen、图像显示 GUI
     - 计算机所有功能最终都是由硬件的操作来实现
   - 操作系统屏蔽了对硬件操作的细节，提供了计算机用户与计算机硬件之间的接口，并且通过这个接口使应用程序的开发变得简单、高效。
   - 操作系统必须完成的两个主要目标如下：
     - 与硬件部分相互作用，为包含在硬件平台上的所有底层可编程部件提供服务
     - 为运行在计算机系统上的应用程序提供执行环境。

3. 资源的管理者
   - 操作系统是资源的管理者
     - 现代计算机系统的一个重要特点是支持多任务，同时驻留多个程序，共同使用计算机软硬件资源
   - 操作系统的主要功能
     - 处理机管理
     - 内存管理
     - 设备管理
     - 文件管理

## 1.2 操作系统的发展

1. 操作系统的发展

   - 无操作系统

     - 第一代计算机（`1945~1955 年`）使用`电子管作为主要的电子器件`，用插件板上的硬连线或穿孔卡片表示程序，`没有用来存储程序的内存`，无操作系统。
     - 需要人工干预，不能连续自动工作

   - 单道批处理系统

     - 第二代计算机（1955~1965 年）使用`晶体管作为主要的电子器件`，开始使用`磁性存储设备`，内外存容量增加，计算机运算速度提高，出现了早期的单道`批处理`系统。
     - 用户程序及程序处理的数据统称为作业
     - 利用存储设备自动装入内存、撤销内存、输出结果，减少 CPU 等待人工操作作业。内存只能留一道用户作业，CPU 和内存被用户作业独占。
     - 程序是指令的集合，程序的执行是 CPU 依次、逐条执行指令的过程
     - 缺点：CPU 利用率低、损失系统的吞吐量
     - 吞吐量：单位时间内计算机系统处理的作业量

   - 多道程序系统（多道批处理系统、分时系统）

     - 多道批处理系统 -> 分时操作系统 -> 多道程序系统
     - 使用`集成电路芯片作为主要的电子器件`。多道程序系统的目的是为了提高 CPU 的利用率。
     - 当运行 I/O 密集型作业时，CPU 等待浪费 80%~90%的时间。为了提供 CPU 利用率，开发了多道程序系统。第一个多道程序系统 IBM 的 OS/360
     - 早期多道程序系统不具有交互功能，被称为多道批处理系统。
     - 为了满足交互功能，产生了分时操作系统，多个用户可以同时通过不同的终端使用主机，主机可以快速响应常见命令。
       - 第一个通用分时系统 CTSS 是麻省理工学院于 1962 年在改装过的 IBM7094 上开发成功

   - 微机操作系统

     - 随着个人计算机的出现，微机操作系统相应产生。第一个微机操作系统是 Intel 公司的顾问 Gary Kildall 编写的 CP/M 系统
     - CP/M 于 1977 年重写，应用于微机 CPU，成为著名的 8 位 OS
     - 20 世纪 80 年代初，微软推出了 MS-DOS。1985 年微软开始构建 Windows 操作系统。

   - 实时操作系统

     - 实时系统是支持实时计算的系统。广泛应用于自动控制、智能机器人、海底探测和航空航天等领域。
       - 要求在规定时间内完成计算，超时就认为计算错误
     - 实时系统 RTOS 通常有高可靠性和支持实时资源调度
       - VxWorks 操作系统是美国 WindRiver 公司于 1983 年设计开发的一种嵌入式实时操作系统
       - uc/OS-II 适用于微处理器、微控制器和数字信号处理的 RTOS 内核
       - Linux 也支持实时性

   - 嵌入式操作系统
   - 物联网操作系统

2. `批处理系统、分时系统、实时系统的特点`

   - 单道批处理系统的特点：
     - 1）自动性
     - 2）顺序性
     - 3）单道性
   - 单道批处理系统的优缺点：
     - 1）优点：与无操作系统相比，减少了等待人工操作的时间
     - 2）缺点：CPU 资源不能得到充分利用
   - 分时系统的特点：
     - 1）多路性
     - 2）独立性
     - 3）及时性
     - 4）交互性
   - 分时系统的优缺点
     - 优点：向用户提供了人机交互的方便性，使多个用户可以通过不同的终端共享主机
     - 缺点：不能及时接收和及时处理用户的命令或数据
   - 实时系统的特点
     - 1）多路性
     - 2）独立性
     - 3）及时性
     - 4）交互性
     - 5）可靠性
   - 实时系统比分时系统要求有更高的可靠性，需要采取多级容错措施来保证系统安全和数据安全。
   - **批处理系统、分时系统和实时系统是三种基本的操作系统类型。实际操作系统可能兼有三者或者两者的特点**

3. 操作系统的产品现状
   - 主机操作系统
     - 运行在大型主机上的操作系统
     - 主要提供三类服务：批处理、事务处理和分时处理
     - 航班预定、银行账户操作，每个业务量很小但每秒并发成百上千个，要求处理速度快。
   - 服务器操作系统
     - 运行在网络服务器上的操作系统
     - 通过网络同时为众多用户服务，允许用户共享硬件和软件资源。
     - Linux、Windows Server 200X、FreeBSD、Solaris
   - 微机操作系统
     - 个人机操作系统
     - Windows 个人操作系统、Linux 的不同发行版、iOS
   - 嵌入式操作系统
     - 宿主于非计算机设备中的计算机系统。
     - 嵌入式操作系统的特征：小巧、实时性、可装卸、代码固化、弱交互性、强稳定性、接口统一、低能耗
     - IOS、安卓、Windows 10 loT Core、FreeRTOS

## 1.3 操作系统的特征

- 现代操作系统都支持多任务，具有四大特征。

1. 并发：指两个或多个事件在`同一时间间隔`内发生。

   - 并发与并行的区分，并行是多个事件同时发生
   - 单 CPU 多任务，宏观上多个程序都在执行，实际上轮流使用 CPU，任意时间只有一个程序在使用 CPU

2. 共享：指系统中的资源可以供内存中`多个并发执行的进程共同使用`。

   - 资源共享有两种方式，即互斥共享和同时共享。
   - 互斥共享：任意时刻一个资源只能被一个进程访问，例如打印机。
   - 同时共享：资源可以被多个进程同时访问，例如内存访问、磁盘访问

3. 虚拟：通过某种技术把一个物理实体变成若干逻辑上对应物

   - 时分复用，打印机
   - 空分复用，网络宽带

4. 异步性：进程以不可预知的速度向前推进，多程序的执行顺序、完成时间等都不可预知。
   - 何时执行、何时暂停、何种速度推进、何时能完成都不可预知

## 1.4 操作系统的功能

1. 内存管理

   - 作用：内存管理的主要任务使为多道程序的运行提供良好的环境，方便用户使用内存，提高内存的利用率，以及从逻辑上扩充内存以实现虚拟内存。
   - 功能：

     - 1）内存分配

       - 主要任务是：为每道程序分配内存空间，使它们各得其所。
       - 两种方式实现：静态分配方式和动态分配方式
       - 为了实现内存的分配，需要以下数据结构和功能支持：
         - 用于内存分配数据结构
         - 内存分配功能
         - 内存回收功能

     - 2）内存保护

       - 主要任务是：
         - 1）使操作系统内核的空间不会被用户随意访问，以保证系统的安全和稳定
         - 2）确保每道用户程序都在自己的内存空间中运行，互不干扰。

     - 3）地址映射

       - CPU 执行程序过程中访问内存时，需要把程序的逻辑地址转变为物理地址，这个转换的过程称为地址映射。
       - 地址映射应在硬件的支持下完成

     - 4）内存扩充
       - 借助于虚拟存储技术，从逻辑上扩充内存容量，使系统能够向用户提供比物理内存大的存储容量。
       - 为了能从逻辑上扩充内存，系统必须具有内存扩充机制，以实现功能：请求调换功能；置换功能。

2. 进程管理

   - 进程管理的功能主要包括：
     - 进程的描述与组织；进程控制；进程同步；进程通信；进程调度；

3. 设备管理

   - 设备管理主要完成用户的 I/O 请求，为用户分配 I/O 设备。
   - 设备管理应该具有以下功能：缓冲管理；设备分配；设备处理；设备独立性和虚拟设备；

4. 文件管理

   - 文件存储空间的管理
   - 目录管理
   - 文件的读、写管理和存取控制

5. 提供用户接口
   - 系统调用是操作系统实现的具有某种功能的程序模块，应用程序可以通过系统调用的接口使用操作系统实现的功能，获得操作系统内核的服务。
   - 命令接口
     - 分为联机用户接口、脱机用户接口
   - 图形接口
     - 20 世纪 90 年代，开始引入图形化用户接口
   - 程序接口
     - 操作系统提供给程序员的接口是系统调用

## 1.5 操作系统的体系结构

1. 软件体系结构简介

   - 操作系统体系结构是操作系统作为软件的体系设计，对操作系统的可靠性、灵活性、可移植性都有重要影响。
   - 软件体系结构：为软件系统提供了一个结构、行为和属性的高级抽象，包括`系统元素的结构`、`元素间的相互关系`、以及`指导元素集成的模式和约束`三个方面。
   - 软件体系结构是一条贯穿软件系统整个生命周期的主线，是软件设计成功的基础和关键，也是对软件大型化、复杂化趋势的一种很好的应对决策。

2. 操作系统体系结构的分析

   - 1.简单的监控程序模型

     - 无操作系统概念，所有功能集中在一个模块。

   - 2.单体结构模型

     - 所有软件和数据结构放在一个逻辑模块中，对外提供系统调用接口。
     - 单体内核是操作系统最早、最常见的体系结构。
     - MS-DOS、Linux、Mac OS X、BSD

   - 3.层次结构模型

     - 将操作系统分解为多个小的、容易理解的层。
     - 系统功能被隔离在不同层中，每一层提供对系统功能的部分抽象。
     - 层间采用单向调用的顺序，形成一连串彼此连续的对系统功能的抽象，最终形成对整个系统的完整抽象。
     - THE 系统

   - 4.客户/服务器模型与微内核结构

     - 微内核结构是操作系统发展的里程碑
     - 微内核结构用一个水平分层的结构代替了传统的纵向分层的结构。
     - 将系统内核功能以服务形式提供接口调用
     - 缺点是效率不高
     - 两个发展方向：通用操作系统、嵌入式操作系统
     - Windows NT、COSIXV2.3、Mach、Vxworks

   - 5.动态可扩展结构模型
     - 基本思想：在运行过程中，能够动态地实现系统行为扩展的结构，也称为弹性结构。
     - 主要技术有：UPCALL 和 DOWNLOAD

## 1.6 指令的执行

1. 指令周期

   - 程序是指令的集合，程序的执行就是按照某种控制流执行指令的过程。
   - 一个单一指令需要的处理称为指令周期。一个指令周期可以划分为两个步骤：取值周期和执行周期。

2. 取指令和执行指令

   - 取指令：在每个指令周期开始时，处理器从存储器中取一条指令。程序计数器（PC）保存有下一次要取的指令的地址，处理器在每次完成取指令操作后总是对 PC 递增。
   - 执行指令：取到的指令被放置在处理器的指令寄存器 IR 中。
   - 处理器解释指令并执行要求的动作，这些动作分为 4 类：
     - 处理器与存储器之间的指令或数据传送操作
     - 处理器与 I/O 设备之间的指令或数据传送操作
     - 算术运算操作或逻辑运算操作
     - 控制操作，即修改指令的执行顺序的操作

3. 一个实例

   - [主机完成一条指令的过程](https://blog.csdn.net/qq_53965368/article/details/120593975)

4. 指令的执行小结
   - 程序执行的过程是反复取指令和执行指令的过程。指令执行的结果就是使寄存器或内存单元的值发生变化，指令执行的过程也就是存储体内容不断变化的过程。
   - 取指令和执行指令由`硬件`完成

- [一条指令在 cpu 中的执行流程](https://www.jianshu.com/p/05c6c1d73144)
- [CPU 执行程序的秘密](https://zhuanlan.zhihu.com/p/264597201)

## 思考与练习题

### 填空题

1. 单道批处理系统的内存中只能驻留`一`道用户作业，CPU 和内存资源被用户作业独占。
2. 单道批处理系统与无操作系统的计算机系统相比而言，减少了`人工操作等待`的时间。
3. 操作系统是一组控制和管理计算机`软件`和`硬件`资源、合理地对各类作业进行调度，以及方便用户的程序集合。
4. 并发是指两个或两个以上的事件在同一`时间间隔`内发生。
5. 现代操作系统的特征包括`并发`、`共享`、`虚拟`、`异步`。

### 简答题

1. 请说明操作系统的作用和功能

   - 作用：操作系统提供计算机用户与计算机硬件之间的接口，并管理计算机软件和硬件资源。操作系统为应用程序提供运行环境。
   - 功能：1）内存管理；2）进程管理；3）设备管理；4）文件管理

2. 请说明单道批处理系统、多道批处理系统、分时系统的特点及优缺点

   - 单道批处理系统
     - 特点： 使用晶体管作为主要的电子器件
     - 优缺点：优点是解决了 CPU 长时间等待人工操作造成的 CPU 资源的严重浪费，缺点是内存中只能驻留一道用户作业，CPU 和内存资源被用户作业独占。
   - 多道批处理系统
     - 特点： 使用集成电路芯片作为主要的电子器件
     - 优缺点：优点是提高了 CPU 的利用率；缺点是不具有交互功能，无法观察和控制作业的运行。
   - 分时系统
     - 特点：

3. 内存管理有哪些主要功能？

   - 1）内存分配；2）内存保护；3）地址映射；4）内存扩充

4. 请说明指令执行的过程。

   - 程序执行的过程是反复取指令和执行指令的过程。
   - 取指令：在每个指令周期开始时，处理器从存储器中取一条指令。
   - 执行指令：取到的指令被放置在处理器的指令寄存器 IR 中。指令中包含确定处理器将要采取动作的位，处理器解释指令并执行要求的动作。

5. 操作系统具有哪些特征？

   - 1）并发；2）共享；3）虚拟；4）异步
