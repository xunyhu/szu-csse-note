## 第三章 传输层
### (一)、传输层的基本服务
传输层在网络提供的主机间分组传输服务的基础上，扩展到运行在不同主机上的进程之间的报文传输，并且实现了**进程间的端到端传输服务**，从而使得网络应用只需关注进程间的端到端通信，而不必关心底层网络采用了什么技术、底层网络如何传输数据等，为网络应用使用网络提供了抽象模式，简化了网络应用开发过程。
1. 传输层功能
2. 传输层寻址与端口
3. 无连接服务与面向连接服务
### (二)、传输层的复用与分解
1. 无连接的多路复用与多路分解
2. 面向连接的多路复用与多路分解
### (三)、停-等协议与滑动窗口协议
1. 可靠数据传输基本原理
2. 停-等协议
3. 滑动窗口协议
### (四)、用户数据报协议（UDP）
1. UDP数据报结构
2. UDP校验和
### (五)、传输控制协议（TCP）
#### TCP报文段结构
#### TCP连接管理  
1. TCP连接管理包括建立连接与连接拆除。TCP连接通过“三次握手”过程。三次握手的目的是连接服务器指定端口，建立 TCP 连接，并同步连接双方的序列号和确认号，交换 TCP 窗口大小信息。在 socket 编程中，客户端执行 `connect()` 时。将触发三次握手。
    - 第一次握手(SYN=1, seq=x):  
        该报文段(SYN报文段)中不包含应用层数据，其首部中的同步位SYN=1，并选择初始序列号seq=x，表明传送数据时的第1个数据字节的序号是x。  
        客户端发送一个 TCP 的 SYN 标志位置1的包，指明客户端打算连接的服务器的端口，以及初始序号 X,保存在包头的序列号(Sequence Number)字段里。发送完毕后，客户端进入 `SYN_SEND` 状态。
    - 第二次握手(SYN=1, ACK=1, seq=y, ack_seq=x+1):  
        一旦包含SYN报文段的IP数据报到达主机B，主机B的TCP收到连接请求段后，如同意，则发回确认报文段(SYNACK段)。SYNACK报文段表明：主机B收到了主机A发起建立连接的SYN报文段，该段的初始序号为x，且主机B同意建立连接，主机B的初始序号是y。与SYN报文段类似，SYNACK报文段不包含应用层数据，但是也要消耗掉1个序号，即初始序号y。   
        服务器发回确认包(ACK)应答。即 SYN 标志位和 ACK 标志位均为1。服务器端选择自己 ISN 序列号，放到 Seq 域里，同时将确认序号(Acknowledgement Number)设置为客户的 ISN 加1，即X+1。 发送完毕后，服务器端进入 `SYN_RCVD` 状态。
    - 第三次握手(ACK=1，ack_seq=y+1):  
        主机A收到SYNACK报文段后，向主机B发送确认报文段，该报文段是对主机B的同意连接报文段确认，其中ACK=1,SYN=0,seq=x+1,ack_seq=y+1。第三次握手的ACK报文段可以携带从主机A到主机B的应用层数据。  
        客户端再次发送确认包(ACK)，SYN 标志位为0，ACK 标志位为1，并且把服务器发来 ACK 的序号字段+1，放在确定字段中发送给对方，并且在数据段放写ISN的+1。发送完毕后，客户端进入 `ESTABLISHED` 状态，当服务器端接收到这个包时，也进入`ESTABLISHED` 状态，TCP 握手结束。  
2. TCP连接建立成功后，便为使用该连接的双方应用进程之间提供了一条端到端全双工的可靠字节流逻辑通信信道，双方应用进程可以使用该连接收发数据。当通信结束时，使用TCP连接的两个进程中的任何一方都可以首先请求终止该连接，即断连。当连接断开后，主机分配给该连接的“资源”将被释放。TCP释放连接过程为“四次挥手过程”。
    - 第一次挥手(FIN=1，seq=x)  
        主机A向主机B发送释放连接报文段，其首部的FIN=1,序号seq=x，等待主机B的确认
    - 第二次挥手(ACK=1，ack_seq=x+1，seq=v)  
        主机B向主机A发送确认段，ACK=1, 确认序号ack_seq=x+1,序号seq=v。
    - 第三次挥手(FIN=1，ack_seq=x+1, seq=w)  
        主机B向主机A发送释放连接报文段，FIN=1，seq=w，ack_seq=x+1。
    - 第四次挥手(ACK=1，seq=x+1，ack_seq=w+1)  
        主机A向主机B发送确认段，ACK=1，seq=x+1，ack_seq=w+1。主机B收到该确认段，可以马上释放连接；主机A在发出该确认段后，延迟一段时间即释放连接。
#### TCP可靠数据传输
#### TCP流量控制
#### TCP拥塞控制

### 参考阅读
- [TCP协议](https://hit-alibaba.github.io/interview/basic/network/TCP.html) 

**考核内容与要求**
- 传输层的基本服务
    - 识记：传输层基本服务
    - 领会：复用与分解的基本概念；UDP与TCP实现复用与分解的方法；无连接服务与面向连接服务。
- 用户数据报协议（UDP）
    - 识记：UDP特点；UDP数据报结构
    - 领会：UDP校验和及其计算
- 停-等协议与滑动窗口协议
    - 领会：可靠数据传输基本原理；停-等协议工作原理；滑动窗口协议工作原理。
    - 应用：停-等协议信道利用率计算；滑动窗口协议信道利用率计算；滑动窗口协议窗口大小与分组序号字段位数之间的约束关系。
- 传输控制协议（TCP）
    - 领会：TCP特点；TCP报文段结构；TCP的可靠数据传输机制；TCP报文段序号与确认序号；TCP连接建立过程与连接拆除过程；TCP计时器超时时间设置；TCP的流量控制；拥塞控制基本概念；TCP的拥塞控制。  
    - 应用：TCP报文段序号与确认序号的变化；TCP流量控制窗口、拥塞窗口、发送窗口的变化。  
**本章重点、难点**
本章重点是可靠数据传输的基本原理、停-等协议、典型滑动窗口协议（GBN协议、SR协议），TCP的报文段结构、TCP连接建立与断开过程、TCP序列号以及确认序列号、TCP可靠数据传输的机制、TCP拥塞控制方法。  
本章难点是停-等协议与滑动窗口协议的理解与信道利用率的计算、TCP的链接管理、TCP报文段序列号、TCP的拥塞控制方法。